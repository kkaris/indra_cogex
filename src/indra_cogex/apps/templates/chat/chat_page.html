{% extends "base.html" %}

{% block head %}
    {{ super() }}

    {% block styles %}
        {{ super() }}
        <!-- Chat app css -->
        <link rel="stylesheet" href="{{ url_for('static', filename='chat/css/app.css') }}">
        {# TODO Add CSS later when there is anything to load <link rel="stylesheet" href="{{ url_for('chat.serve_vue', filename='') }}">#}
{#        <link rel="stylesheet" href="{{ url_for('chat.serve_vue', file='IndralabVue.css') }}">#}
    {% endblock %}


{% endblock %}

{% block container %}
    {{ super() }}
    <div class="chatbubble opened">
        <div class="chat-title">
            <div class="title">Chat with INDRA CoGEx</div>
        </div>
        <div class="expanded chat-window">
            <div class="login-screen container">
                <form id="loginScreenForm">
                    <div class="form-row">
                        <div class="col-md-6 form-group">
                            <input type="text" class="form-control" id="fullname" placeholder="Name*" required>
                        </div>
                        <div class="col-md-6 form-group">
                            <input type="email" class="form-control" id="email" placeholder="Email Address*" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <button type="submit" class="btn btn-block btn-primary">Start Chat</button>
                    </div>
                </form>
            </div>
            <div class="chats">
                <div class="loader-wrapper">
                    <div class="loader">
                        <span>{</span><span>}</span>
                    </div>
                </div>
                <div class="input">
                    <form class="form-inline" id="messageSupport">
                        <div class="form-group">
                            <input type="text" autocomplete="off" class="form-control" id="newMessage"
                                   placeholder="Enter Message">
                        </div>
                        <button type="submit" class="btn btn-primary">Send</button>
                    </form>
                </div>
                <ul class="messages clearfix overflow-auto">
                </ul>
            </div>
        </div>
    </div>
    {% raw %}
    <div id="vue-app">
        <p>Vue stuff goes here</p>

        <div class="row">
            <div class="col-6">
                <span>First message: {{ messages[0] }}</span>
            </div>
            <div class="col-6">
                <span>input-text component should be here</span>
                <input-text></input-text>
            </div>
        </div>
        <div class="row">
            <div class="col-6">
                <span>Second message: {{ messages[1] }}</span>
            </div>
            <div class="col-6">
                <span>input-text-area component should be here</span>
                <input-text-area></input-text-area>
            </div>
        </div>

        <!--
        <div class="list-group list-group-flush">
            <Statement
                    class="list-group-item"
                    :key="st_obj.hash"
                    :evidence="st_obj.ev_array"
                    :english="st_obj.english"
                    :hash="st_obj.hash"
                    :sources="st_obj.sources"
                    :total_evidence="st_obj.total_evidence"
                    :loadable="false"
            ></Statement>
        </div>
        -->
        <!-- <HelloWorld msg="Vue is working"/> -->
    </div>
    {% endraw %}
{% endblock %}

{% block scripts %}
    {{ super() }}
    <!-- Load Pusher -->
    <script src="https://js.pusher.com/4.0/pusher.min.js"></script>
    <!--- Vue 3 -->
    <script src="https://unpkg.com/vue@3"></script>
    <!--- Locally served vue components -->
{#    <script src="{{ url_for('chat.serve_vue', file='IndralabVue.umd.min.js') }}"></script>#}
            <script src="{{ url_for('chat.serve_vue', file='CogexChat.umd.js') }}"></script>
    {#    <script src="{{ url_for('chat.serve_vue', file='TestApp.umd.js') }}"></script>#}

    <script>
        // Import components
        {#const {#}
        {#    Statement,#}
        {#    SourceDisplay,#}
        {#    Evidence,#}
        {#    CurationRow,#}
        {#    RefLink,} = IndralabVue;#}
        const {InputText, InputTextArea} = CogexChat;
        {#const {HelloWorld} = TestApp;#}

        // Vue app
        const {createApp} = Vue;
        const app = createApp({
            components: {
                {#Statement,#}
                {#SourceDisplay,#}
                {#Evidence,#}
                {#CurationRow,#}
                {#RefLink,#}
                {#InputText,#}
                {#InputTextArea#}
            },
            data() {
                return {
                    messages: ['Hello', 'Vue!'],
                    user: {
                        name: '',
                        email: ''
                    },
                    loading: false,
                    error: false,
                    errorMessage: '',
                    st_obj: {
                        hash: '123456789',
                        english: 'This is a statement',
                        ev_array: [
                            {
                                text: 'This is evidence',
                                pmid: '123456789',
                                source_api: 'sparser',
                                text_refs: {
                                    PMID: '123456789'
                                },
                                num_curations: 0,
                                source_hash: '123456789',
                                stmt_hash: '123456789',
                                original_json: {},
                            }
                        ],
                        total_evidence: 1,
                        sources: {},
                        badges: {}
                    },
                }
            }
        });

        // Register components
        {#app.component('Statement', Statement);#}
        {#app.component('SourceDisplay', SourceDisplay);#}
        {#app.component('Evidence', Evidence);#}
        {#app.component('CurationRow', CurationRow);#}
        {#app.component('RefLink', RefLink);#}
        app.component('input-text', InputText);
        app.component('input-text-area', InputTextArea);
        {#app.component('HelloWorld', HelloWorld);#}
        {#app.config.globalProperties.$stmt_hash_url = "/";  // URL to get more evidence for a statement#}
        {#app.config.globalProperties.$curation_url = "/";#}
        {#app.config.globalProperties.$curation_list_url = "/";#}
        {#app.config.globalProperties.$sources = {};#}
        {#app.config.compilerOptions.isCustomElement = (tag) => tag.includes('-');#}
        app.mount('#vue-app');

        const pusher = new Pusher('{{ pusher_app_key }}', {
            authEndpoint: '{{ url_for('chat.pusher_authentication') }}',
            cluster: 'mt1',
            encrypted: true
        });
        console.log(typeof window.Popper === 'undefined' ? 'Popper is loaded' : 'Popper is loaded');
        console.log(Boolean('{{ pusher_app_key }}') ? 'Pusher app key defined' : 'Pusher app key not defined');
    </script>
    <script type="text/javascript" src="{{ url_for('static', filename='chat/js/axios.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='chat/js/app.js') }}"></script>
{% endblock %}
<script>
    import InputText from "../../static/vue-chat/src/components/InputText";
    export default {
        components: {InputText}
    }
</script>
<script>
    import InputTextArea from "../../static/vue-chat/src/components/InputTextArea";
    export default {
        components: {InputTextArea}
    }
</script>